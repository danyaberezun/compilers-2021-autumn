-- Expression evaluator

import List;
import State;


public fun evalBinaryOperation(opStr, left, right) {
  case opStr of
    "+" -> left + right
    | "-" -> left - right
    | "*" -> left * right
    | "/" -> left / right
    | "%" -> left % right
    | "==" -> left == right
    | "!=" -> left != right
    | "&&" -> left && right
    | "!!" -> left !! right
    | "<" -> left < right
    | ">" -> left > right
    | "<=" -> left <= right
    | ">=" -> left >= right
    | _ -> failure("Operator %s is not implemented\n", opStr)
  esac
}

public fun evalExpr(state, expr) {
  case expr of
    Var(name) -> state(name)
    | Const(value) -> value
    | Binop(op, left, right) -> evalBinaryOperation(op, evalExpr(state, left), evalExpr(state, right))
    | _ -> failure("Unkown expression type")
  esac
}